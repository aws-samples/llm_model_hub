# ANSI 日志渲染功能说明

## 功能概述

日志显示组件现在支持 ANSI 转义码渲染，可以显示彩色和格式化的日志输出。

## 支持的转义码格式

组件会自动转换以下格式的 ANSI 转义码：

1. `#033[...m` - 您的日志中使用的格式
2. `\033[...m` - 标准格式
3. `\x1b[...m` - 十六进制格式
4. `\e[...m` - 简写格式

## 支持的颜色和样式

### 前景色
- `#033[30m` - 黑色
- `#033[31m` - 红色
- `#033[32m` - 绿色
- `#033[33m` - 黄色
- `#033[34m` - 蓝色
- `#033[35m` - 洋红色
- `#033[36m` - 青色
- `#033[37m` - 白色

### 样式
- `#033[0m` - 重置所有样式
- `#033[1m` - 粗体
- `#033[2m` - 暗淡/半透明
- `#033[3m` - 斜体
- `#033[4m` - 下划线

### 示例日志

**原始日志：**
```
2025-11-03 10:29:52,625 - INFO - train.py:236 - #033[36m(BatchFunctionRewardManager pid=22268)#033[0m **Rating**: 5.0
```

**显示效果：**
```
2025-11-03 10:29:52,625 - INFO - train.py:236 - (BatchFunctionRewardManager pid=22268) **Rating**: 5.0
                                                   ^^^^^^^^^^^^^^^^ 青色显示 ^^^^^^^^^^^^^^^^
```

## 使用方法

### 在日志查看器中

1. 打开训练任务的日志页面
2. 确保 **ANSI Colors** 开关是开启状态（默认开启）
3. 日志中的颜色代码会自动渲染为实际颜色

### 调试

打开浏览器的开发者工具控制台，可以看到第一行日志的转换信息：

```javascript
ANSI Conversion: {
  original: "2025-11-03 10:29:52,625 - INFO - #033[36m...",
  converted: "2025-11-03 10:29:52,625 - INFO - \x1b[36m...",
  hasEscapeCodes: true
}
```

## 切换显示模式

如果 ANSI 渲染出现问题，可以通过以下方式切换到纯文本模式：

1. 点击日志查看器上方的 **ANSI Colors** 切换开关
2. 日志将以原始文本格式显示在 Textarea 中

## 测试文件

可以在浏览器中打开 `ansi-test.html` 查看颜色渲染示例和测试。

## 技术实现

- 使用 `anser` 库解析 ANSI 转义码
- 自动将 `#033` 格式转换为标准的 `\x1b` 格式
- 渲染为带内联样式的 React 组件
- 使用深色主题背景以更好地展示彩色日志

## 性能优化

- 使用 `useMemo` 缓存解析结果
- 只在日志内容变化时重新解析
- 保持最大 5000 行的显示限制以确保流畅性能
